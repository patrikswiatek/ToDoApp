image: node:latest

cache:
  paths:
  - node_modules/
  - .yarn-cache/
  
stages:
  - test
  - deploy

test:
  stage: test
  script:
     - curl -o- -L https://yarnpkg.com/install.sh | bash
     - "export PATH=\"$HOME/.yarn/bin:$PATH\""
     - yarn install --cache-folder .yarn-cache
     - yarn test

publish:
  stage: deploy
  script:
    - npm config set //registry.npmjs.org/:_authToken=$NPM_TOKEN -q
    - npm publish
  only:
    - master
